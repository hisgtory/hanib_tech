.PHONY: build clean install uninstall link unlink test help

BINARY_NAME=hanib
BUILD_DIR=.
INSTALL_DIR=/usr/local/bin
GO=go

# ê¸°ë³¸ íƒ€ê²Ÿ
all: build

# ë¹Œë“œ
build:
	@echo "ğŸ”¨ Building $(BINARY_NAME)..."
	@$(GO) build -o $(BUILD_DIR)/$(BINARY_NAME) .
	@echo "âœ“ Build complete: $(BUILD_DIR)/$(BINARY_NAME)"

# í´ë¦°
clean:
	@echo "ğŸ§¹ Cleaning..."
	@rm -f $(BUILD_DIR)/$(BINARY_NAME)
	@echo "âœ“ Clean complete"

# ì „ì—­ ì„¤ì¹˜ (ë³µì‚¬)
install: build
	@echo "ğŸ“¦ Installing to $(INSTALL_DIR)..."
	@sudo cp $(BUILD_DIR)/$(BINARY_NAME) $(INSTALL_DIR)/$(BINARY_NAME)
	@echo "âœ“ Installed: $(INSTALL_DIR)/$(BINARY_NAME)"

# ì „ì—­ ì œê±°
uninstall:
	@echo "ğŸ—‘ï¸  Uninstalling..."
	@sudo rm -f $(INSTALL_DIR)/$(BINARY_NAME)
	@echo "âœ“ Uninstalled"

# ì‹¬ë³¼ë¦­ ë§í¬ (ê°œë°œìš©)
link: build
	@echo "ğŸ”— Creating symlink..."
	@sudo ln -sf $(CURDIR)/$(BINARY_NAME) $(INSTALL_DIR)/$(BINARY_NAME)
	@echo "âœ“ Linked: $(INSTALL_DIR)/$(BINARY_NAME) -> $(CURDIR)/$(BINARY_NAME)"

# ì‹¬ë³¼ë¦­ ë§í¬ ì œê±°
unlink:
	@echo "ğŸ”— Removing symlink..."
	@sudo rm -f $(INSTALL_DIR)/$(BINARY_NAME)
	@echo "âœ“ Unlinked"

# í…ŒìŠ¤íŠ¸ ì‹¤í–‰
test: build
	@echo "ğŸ§ª Running tests..."
	@echo ""
	@echo "=== hanib list ==="
	@cd ../.. && ./tools/hanib-cli/$(BINARY_NAME) list
	@echo ""
	@echo "âœ“ Tests complete"

# ì˜ì¡´ì„± ì„¤ì¹˜
deps:
	@echo "ğŸ“¥ Installing dependencies..."
	@$(GO) mod tidy
	@echo "âœ“ Dependencies installed"

# ë„ì›€ë§
help:
	@echo "hanib-cli Makefile"
	@echo ""
	@echo "Usage:"
	@echo "  make build     ë¹Œë“œ"
	@echo "  make clean     ë¹Œë“œ ê²°ê³¼ë¬¼ ì‚­ì œ"
	@echo "  make install   ì „ì—­ ì„¤ì¹˜ (/usr/local/binì— ë³µì‚¬)"
	@echo "  make uninstall ì „ì—­ ì œê±°"
	@echo "  make link      ì‹¬ë³¼ë¦­ ë§í¬ ìƒì„± (ê°œë°œìš©)"
	@echo "  make unlink    ì‹¬ë³¼ë¦­ ë§í¬ ì œê±°"
	@echo "  make test      í…ŒìŠ¤íŠ¸ ì‹¤í–‰"
	@echo "  make deps      ì˜ì¡´ì„± ì„¤ì¹˜"
	@echo "  make help      ì´ ë„ì›€ë§"
