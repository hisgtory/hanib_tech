# 개발 원칙

## 기술 스택

### 백엔드
| 기술 | 버전 | 용도 |
|------|------|------|
| Go | 1.24+ | 서버 언어 |
| Fiber | v2 | HTTP 프레임워크 |
| Claude CLI | - | AI 연동 |

### 프론트엔드
| 기술 | 버전 | 용도 |
|------|------|------|
| React | 18 | UI 라이브러리 |
| Vite | 7 | 빌드 도구 |
| TypeScript | 5 | 타입 안전성 |
| Emotion | - | CSS-in-JS |
| Monaco Editor | - | 코드 에디터 |

## 코드 원칙

### 1. 단순함 우선 (Simplicity First)
```
좋은 예: 필요한 기능만 구현
나쁜 예: "나중에 필요할 것 같아서" 미리 추상화
```

- 오버엔지니어링 금지
- 추상화는 3번 반복된 후에
- 설정보다 관례 (Convention over Configuration)

### 2. 파일 구조는 기능 기반

```
tools/hanib/
├── cmd/           # 실행 진입점
│   ├── cli/       # CLI 도구
│   └── server/    # 웹 서버
├── pkg/           # 재사용 가능한 패키지
│   ├── content/   # 콘텐츠 파싱
│   └── git/       # Git 연동
└── web/           # 프론트엔드
    └── src/
        └── components/  # React 컴포넌트
```

### 3. API 설계 원칙

```
GET    /api/tree           # 읽기
GET    /api/file?path=...  # 읽기 (쿼리 파라미터)
PUT    /api/file           # 수정
POST   /api/claude         # 액션 (SSE 스트리밍)
```

- RESTful 기본 준수
- SSE로 스트리밍 (WebSocket 대신)
- JSON 응답 통일

### 4. 에러 처리

```go
// Go: 에러 즉시 반환
if err != nil {
    return c.Status(500).JSON(fiber.Map{"error": err.Error()})
}
```

```typescript
// TypeScript: try-catch로 감싸기
try {
    const res = await fetch(url);
    const data = await res.json();
} catch (err) {
    console.error('Failed:', err);
}
```

### 5. 상태 관리

- **서버**: 상태 없음 (Stateless)
- **클라이언트**: React useState/useCallback 사용
- 전역 상태는 최소화 (Context 필요시에만)

## Git 컨벤션

### 브랜치 전략
```
main                    # 프로덕션
feat/기능명             # 기능 개발
fix/버그명              # 버그 수정
```

### 커밋 메시지
```
feat: 새 기능 추가
fix: 버그 수정
refactor: 리팩토링
docs: 문서 수정
chore: 빌드, 설정 등
```

### 커밋 단위
- 하나의 논리적 변경 = 하나의 커밋
- 너무 크면 나누고, 너무 작으면 squash

## 테스트 전략

### 현재 상태
- 자동화된 테스트 없음 (MVP 단계)
- 수동 테스트로 검증

### 향후 계획
```
1. E2E 테스트: Playwright
2. 단위 테스트: Go testing, Vitest
3. API 테스트: httptest
```

## 배포 전략

### 개발 환경
```bash
# 터미널 1: 백엔드
cd tools/hanib && go run ./cmd/server

# 터미널 2: 프론트엔드
cd tools/hanib/web && npm run dev
```

### 프로덕션 빌드
```bash
cd tools/hanib
make build  # Go 빌드 + Vite 빌드
./hanib-server --port 3000
```

## 보안 고려사항

### 파일 시스템 접근
```go
// 경로 탈출 방지
fullPath := filepath.Join(root, path)
if !strings.HasPrefix(fullPath, root) {
    return c.Status(403).JSON(fiber.Map{"error": "access denied"})
}
```

### Claude 연동
- `--allowedTools Edit,Write,Read`로 권한 제한
- 작업 디렉토리를 콘텐츠 루트로 제한

## 성능 고려사항

### 자동 저장
```typescript
// 1초 디바운스로 API 호출 최소화
saveTimeoutRef.current = setTimeout(async () => {
    await saveFile();
}, 1000);
```

### 트리 로딩
- 전체 트리를 한 번에 로드
- 향후 필요시 lazy loading 적용
